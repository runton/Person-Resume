function infoToggle(a){$(a).addClass("tab-pane fade in active").siblings("div").removeClass("in active")}function contentToggle(a,b){$(a).siblings().addClass("hidden");$(a).removeClass("hidden");$($(a+" .row1 ul li")[b]).addClass("active").siblings("li").removeClass("active")}var ue=UE.getEditor("editor",{initialFrameHeight:900,scaleEnabled:true});var ue2=UE.getEditor("editor2",{initialFrameHeight:900,scaleEnabled:true});function isFocus(a){alert(UE.getEditor("editor").isFocus());UE.dom.domUtils.preventDefault(a)}function setblur(a){UE.getEditor("editor").blur();UE.dom.domUtils.preventDefault(a)}function insertHtml(){var a=prompt("插入html代码","");UE.getEditor("editor").execCommand("insertHtml",a)}function createEditor(){enableBtn();UE.getEditor("editor")}function getAllHtml(){alert(UE.getEditor("editor").getAllHtml())}function getContent(){var a=[];a.push("使用editor.getContent()方法可以获得编辑器的内容");a.push("内容为：");a.push(UE.getEditor("editor").getContent());alert(a.join("\n"))}function getPlainTxt(){var a=[];a.push("使用editor.getPlainTxt()方法可以获得编辑器的带格式的纯文本内容");a.push("内容为：");a.push(UE.getEditor("editor").getPlainTxt());alert(a.join("\n"))}function setContent(b){var a=[];a.push("使用editor.setContent('欢迎使用ueditor')方法可以设置编辑器的内容");UE.getEditor("editor").setContent("欢迎使用ueditor",b);alert(a.join("\n"))}function setDisabled(){UE.getEditor("editor").setDisabled("fullscreen");disableBtn("enable")}function setEnabled(){UE.getEditor("editor").setEnabled();enableBtn()}function getText(){var b=UE.getEditor("editor").selection.getRange();b.select();var a=UE.getEditor("editor").selection.getText();alert(a)}function getContentTxt(){var a=[];a.push("使用editor.getContentTxt()方法可以获得编辑器的纯文本内容");a.push("编辑器的纯文本内容为：");a.push(UE.getEditor("editor").getContentTxt());alert(a.join("\n"))}function hasContent(){var a=[];a.push("使用editor.hasContents()方法判断编辑器里是否有内容");a.push("判断结果为：");a.push(UE.getEditor("editor").hasContents());alert(a.join("\n"))}function setFocus(){UE.getEditor("editor").focus()}function deleteEditor(){disableBtn();UE.getEditor("editor").destroy()}function disableBtn(d){var e=document.getElementById("btns");var c=UE.dom.domUtils.getElementsByTagName(e,"button");for(var b=0,a;a=c[b++];){if(a.id==d){UE.dom.domUtils.removeAttributes(a,["disabled"])}else{a.setAttribute("disabled","true")}}}function enableBtn(){var d=document.getElementById("btns");var c=UE.dom.domUtils.getElementsByTagName(d,"button");for(var b=0,a;a=c[b++];){UE.dom.domUtils.removeAttributes(a,["disabled"])}}function getLocalData(){alert(UE.getEditor("editor").execCommand("getlocaldata"))}function clearLocalUeData(){UE.getEditor("editor").execCommand("clearlocaldata");alert("已清空草稿箱")}function getUserInfo(){var a=getCookie("login_id");if(a==""){var b=GetRequest();a=b.user_id}$.get("php/runton_user_info.php",{user_id:a},function(c){$("#username").val(c.username);$("#password").val(c.passwd);$("#userImg").val(c.user_pic);$("#name").val(c.name);$("#sex").val(c.sex);$("#birthday").val(c.birth);$("#email").val(c.email);$("#tel").val(c.tel);$("#question").val(c.question);$("#answer").val(c.answer);$("#create_time").val(c.reg_time.substring(0,10))})}var artListBool=false;function readyArticle(){if(!artListBool){var a=getCookie("login_id");$.post("php/runton_user_artLists.php",{login_id:a},function(b){if(b.length>0){drawArtList(b,10,1);var c=new Paging();c.init({target:"#pageTool",pagesize:10,count:b.length});c.bindEvent=function(){var d=this;this.container.on("click","li.js-page-action,li.ui-pager",function(f){if($(this).hasClass("ui-pager-disabled")||$(this).hasClass("focus")){return false}if($(this).hasClass("js-page-action")){if($(this).hasClass("js-page-first")){d.current=1;drawArtList(b,10,1)}if($(this).hasClass("js-page-prev")){d.current=Math.max(1,d.current-1);drawArtList(b,10,d.current)}if($(this).hasClass("js-page-next")){d.current=Math.min(d.pagecount,d.current+1);drawArtList(b,10,d.current)}if($(this).hasClass("js-page-last")){d.current=d.pagecount;drawArtList(b,10,d.current)}}else{if($(this).data("page")){d.current=parseInt($(this).data("page"));drawArtList(b,10,d.current)}}d.go()})};c.bindEvent()}});artListBool=true}}function drawArtList(e,c,d){var g="";var b=Math.ceil(e.length/c);var f=d!=b?c*d:e.length;for(var a=c*(d-1);a<f;a++){g+="<tr data-tid='"+e[a].tid+"'><td class='td-number'>"+(a+1)+"</td>";g+="<td class='tb-title'>"+e[a].title+"</td>";g+="<td class='td-author'>"+e[a].authorname+"</td>";g+="<td class='td-decoration'>"+e[a].decoration+"</td>";if(e[a].type=="0"){g+="<td class='td-type'>转载</td>"}else{g+="<td class='td-type'>原创</td>"}if(e[a].state=="0"){g+="<td class='td-state'>保存</td>"}else{if(e[a].state=="1"){g+="<td class='td-state'>待审核</td>"}}if(e[a].state=="2"){g+="<td class='td-state'>通过审核</td>"}if(e[a].state=="3"){g+="<td class='td-state'>未通过审核</td>"}g+="<td class='td-createTime'>"+e[a].create_time+"</td>";g+="<td class='td-alterTime'>"+e[a].alter_time+"</td>";g+="<td class='td-operate'><a href='runton_article.html?tid="+e[a].tid+"'>浏览</a><a href='javascript:fillAlterForm("+e[a].tid+");'>修改</a><a href='#'>删除</a></td></tr>"}$("#allArticle table tbody").empty().append(g)}$(document).ready(function(){var a=getCookie("login_id");if(getCookie("PHPSESSID")&&a){$("nav .container ul li .user_center").removeClass("hidden");$("nav .container ul li .login-reg").addClass("hidden")}else{window.location.href="index.html"}getUserInfo();$.post("php/runton_user_artLists.php",{login_id:a},function(b){if(b.length>0){loadArtList(b)}})});$("#left_navbar").on("click",".row dl dd a",function(b){b.preventDefault();var c=b.target;var a=c.getAttribute("data-item");switch(a){case"1":contentToggle(".userInfo",0);infoToggle("#personInfo");break;case"2":contentToggle(".userInfo",1);infoToggle("#loginInfo");break;case"3":contentToggle(".userEditor",0);infoToggle("#allArticle");readyArticle();break;case"4":contentToggle(".userEditor",1);infoToggle("#addNewArticle");break;case"5":contentToggle(".userEditor",2);infoToggle("#alertArticle");break;case"6":contentToggle(".userEditor",3);infoToggle("#deletedArticle");break;case"7":contentToggle(".census",0);infoToggle("#postRecord");break;case"8":contentToggle(".census",1);infoToggle("#visitedRecord");break;default:break}});$("div.userEditor .row1 ul li").first().one("click",function(){readyArticle()});function sendArticleData(f,e,d){var c=$("#articleForm").serialize();var g=$("#label").val();var a=ue.getContent();if(a==""){alert("文章内容不允许为空。提交失败。");return false}a=encodeURIComponent(a);var b=c+"&state="+f+"&login_id="+getCookie("login_id")+"&labels="+g+"&editorValue="+a;$.post("php/runton_usercenter.php",b,function(h){if(h=="succ"){alert(e)}else{if(h=="fail"){alert(d)}}})}$("#articleForm").submit(function(a){a.preventDefault();if(getCookie("login_id")&&getCookie("PHPSESSID")){sendArticleData(2,"文章提交成功，正在审核...","文章提交失败，请稍后再试。")}});$("#save").click(function(){if(getCookie("login_id")&&getCookie("PHPSESSID")){var a=sendArticleData(1,"文章保存成功...","文章保存失败，请稍后再试。")}else{alert("您长时间没有操作，请重新登录后再试。")}});$("#clear").click(function(){$("#articleForm *[name]").val("");$("#label").val("");ue.setContent("","")});var updateBool=false;var password=document.getElementById("password");var passwdTip=document.getElementById("passwdTip");password.onfocus=function(){passwdTip.className="col-sm-3 control-label show control-default";passwdTip.innerHTML="密码由6至12位的数字和字母混合组成."};password.onblur=function(){if(password.validity.valid){passwdTip.className="col-sm-3 control-label show control-success";passwdTip.innerHTML="密码正确."}else{if(password.validity.valueMissing){passwdTip.className="col-sm-3 control-label show control-error";passwdTip.innerHTML="密码不能为空."}else{if(password.validity.patternMismatch){passwdTip.className="col-sm-3 control-label show control-error";passwdTip.innerHTML="密码输入有误."}}}};var uname=document.getElementById("name");var nameTip=document.getElementById("nameTip");uname.onfocus=function(){nameTip.className="col-sm-3 control-label show control-default";nameTip.innerHTML="用户名长度不超过8个字符"};uname.onblur=function(){if(uname.validity.valid){nameTip.className="col-sm-3 control-label show control-success";nameTip.innerHTML="用户名正确."}else{if(uname.validity.patternMismatch){nameTip.className="col-sm-3 control-label show control-error";nameTip.innerHTML="用户名输入有误."}}};uname.onchange=function(){updateBool=true;console.log(updateBool)};var email=document.getElementById("email");var emailTip=document.getElementById("emailTip");email.onfocus=function(){emailTip.className="col-sm-3 control-label show control-default";emailTip.innerHTML="请输入有效的邮件地址。"};email.onblur=function(){if(email.validity.valid){emailTip.className="col-sm-3 control-label show control-success";emailTip.innerHTML="邮件地址正确."}else{if(email.validity.valueMissing){emailTip.className="col-sm-3 control-label show control-error";emailTip.innerHTML="邮件地址不能为空."}else{if(email.validity.patternMismatch){emailTip.className="col-sm-3 control-label show control-error";emailTip.innerHTML="邮件名输入有误."}}}};email.onchange=function(){updateBool=true;console.log(updateBool)};var tel=document.getElementById("tel");var telTip=document.getElementById("telTip");tel.onfocus=function(){telTip.className="col-sm-3 control-label show control-default";telTip.innerHTML="请输入手机号。"};tel.onblur=function(){if(tel.validity.valid){telTip.className="col-sm-3 control-label show control-success";telTip.innerHTML="手机号正确."}else{if(tel.validity.patternMismatch){telTip.className="col-sm-3 control-label show control-error";telTip.innerHTML="手机号输入有误."}}};tel.onchange=function(){updateBool=true;console.log(updateBool)};var answer=document.getElementById("answer");var answerTip=document.getElementById("answerTip");answer.onfocus=function(){answerTip.className="col-sm-3 control-label show control-default";answerTip.innerHTML="请输入20个以内字符。"};answer.onblur=function(){if(answer.validity.valid){answerTip.className="col-sm-3 control-label show control-success";answerTip.innerHTML="输入正确."}else{if(answer.validity.patternMismatch){answerTip.className="col-sm-3 control-label show control-error";answerTip.innerHTML="字符长度有误."}}};answer.onchange=function(){updateBool=true;console.log(updateBool)};var birthday=document.getElementById("birthday");var question=document.getElementById("question");birthday.onchange=function(){updateBool=true;console.log(updateBool)};question.onchange=function(){updateBool=true;console.log(updateBool)};$("#personInfo form input.save").click(function(b){b.preventDefault();if(answer.validity.valid&&tel.validity.valid&&email.validity.valid&&uname.validity.valid&&password.validity.valid){var a=$("#personInfo form").serialize();$.get("php/runton_update_userinfo.php",a,function(c){if(c=="fail"){alert("信息未更改。")}else{alert("信息更改成功。")}})}});$("#personInfo form input.cancel").click(function(){getUserInfo()});$("#passwdTip button").click(function(){if($(this).html()=="查看密码"){$("#password").attr("type","text");$(this).html("隐藏密码")}else{if($(this).html()=="隐藏密码"){$("#password").attr("type","password");$(this).html("查看密码")}}});function loadArtList(c){var b="";for(var a=0;a<c.length;a++){b+="<option value='"+c[a].tid+"'>"+c[a].tid+"</option>"}$("#tid").append(b)}function fillAlterForm(a){$.post("php/article_detail.php",{tid:a},function(b){if(b!=[]){$("#title2").val(b.title);$("#author2").val(b.authorname);var e=b.label.split(",");for(var c in e){$("#label2").find("option[value='"+e[c]+"']").attr("selected",true)}var d=parseInt(b.type);if(d==1){$("#Reprint2").removeAttr("checked");$("#Original2").attr("checked",true);$("#Original2").click()}else{if(d==0){$("#Original2").removeAttr("checked");$("#Reprint2").attr("checked",true);$("#Reprint2").click()}}$("#loadUrl2").val(b.loadUrl);$("#decoration2").val(b.decoration);ue2.execCommand("insertHtml",b.htmlText)}else{alert("获取文章详细信息失败。")}})}$("#tid").change(function(c){var b=c.target;var a=b.value;if(a!=0){$("#articleForm2 *[name]:not([name='tid'])").val("");ue2.setContent("",false);fillAlterForm(a)}else{$("#articleForm2 *[name]").val("");ue2.setContent("",false)}});$("#articleForm2").submit(function(d){d.preventDefault();if(getCookie("login_id")&&getCookie("PHPSESSID")){var c=$("#articleForm2").serialize();var f=$("#label2").val();var a=ue2.getContent();if(a==""){alert("文章内容不允许为空。提交失败。");return false}var b=c+"&state="+2+"&login_id="+getCookie("login_id")+"&labels="+f;$.post("php/runton_alter_user_blog.php",b,function(e){if(e=="succ"){alert("文章提交成功。")}else{if(e=="fail"){alert("修改提交失败。")}}})}});$("#save2").click(function(){if(getCookie("login_id")&&getCookie("PHPSESSID")){var c=$("#articleForm2").serialize();var d=$("#label2").val();var a=ue2.getContent();if(a==""){alert("文章内容不允许为空。提交失败。");return false}var b=c+"&state="+0+"&login_id="+getCookie("login_id")+"&labels="+d;$.post("php/runton_alter_user_blog.php",b,function(e){if(e=="succ"){alert("文章保存成功。")}else{if(e=="fail"){alert("修改保存失败。")}}})}});