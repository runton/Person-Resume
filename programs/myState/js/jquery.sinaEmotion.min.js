function Hashtable(){this._hash=new Object();this.put=function(a,b){if(typeof(a)!="undefined"){if(this.containsKey(a)==false){this._hash[a]=typeof(b)=="undefined"?null:b;return true}else{return false}}else{return false}};this.remove=function(a){delete this._hash[a]};this.size=function(){var b=0;for(var a in this._hash){b++}return b};this.get=function(a){return this._hash[a]};this.containsKey=function(a){return typeof(this._hash[a])!="undefined"};this.clear=function(){for(var a in this._hash){delete this._hash[a]}}}var emotions=new Array();var categorys=new Array();var uSinaEmotionsHt=new Hashtable();$(function(){$.ajax({dataType:"json",url:"json/jquery.sinaEmotion.json",success:function(a){var c=a.data;for(var b in c){if(c[b].category==""){c[b].category="默认"}if(emotions[c[b].category]==undefined){emotions[c[b].category]=new Array();categorys.push(c[b].category)}emotions[c[b].category].push({name:c[b].phrase,icon:c[b].icon});uSinaEmotionsHt.put(c[b].phrase,c[b].icon)}}})});function AnalyticEmotion(d){if(typeof(d)!="undefined"){var b=d.match(/\[.*?\]/g);if(null==b){return d}for(var c=0;c<b.length;c++){if(uSinaEmotionsHt.containsKey(b[c])){var a='<img src="'+uSinaEmotionsHt.get(b[c])+'" height="22" width="22" />';d=d.replace(b[c],a)}}}return d}(function(a){a.fn.SinaEmotion=function(d){var b;var c;a(this).click(function(h){h.stopPropagation();var i=d.offset().top+d.height()+45;var g=d.offset().left-1;if(a("#emotions .categorys")[0]){a("#emotions").css({top:i,left:g});a("#emotions").toggle();return}a("body").append('<div id="emotions"></div>');a("#emotions").css({top:i,left:g});a("#emotions").html("<div>正在加载，请稍候...</div>");a("#emotions").click(function(j){j.stopPropagation()});a("#emotions").html('<div style="float:right"><a href="javascript:void(0);" id="prev">&laquo;</a><a href="javascript:void(0);" id="next">&raquo;</a></div><div class="categorys"></div><div class="containersina"></div><div class="page"></div>');a("#emotions #prev").click(function(){f(c-1)});a("#emotions #next").click(function(){f(c+1)});f();e()});a("body").click(function(){a("#emotions").remove()});a.fn.insertText=function(g){this.each(function(){if(this.tagName!=="INPUT"&&this.tagName!=="TEXTAREA"){return}if(document.selection){this.focus();var i=document.selection.createRange();i.text=g;i.collapse();i.select()}else{if(this.selectionStart||this.selectionStart=="0"){var j=this.selectionStart,h=this.selectionEnd;this.value=this.value.substring(0,j)+g+this.value.substring(h,this.value.length);this.selectionStart=this.selectionEnd=j+g.length}else{this.value+=g}}});return this};function f(){var h=arguments[0]?arguments[0]:0;if(h<0||h>=categorys.length/5){return}a("#emotions .categorys").html("");c=h;for(var g=h*5;g<(h+1)*5&&g<categorys.length;++g){a("#emotions .categorys").append(a('<a href="javascript:void(0);">'+categorys[g]+"</a>"))}a("#emotions .categorys a").click(function(){e(a(this).text())});a("#emotions .categorys a").each(function(){if(a(this).text()==b){a(this).addClass("current")}})}function e(){var h=arguments[0]?arguments[0]:"默认";var j=arguments[1]?arguments[1]-1:0;a("#emotions .containersina").html("");a("#emotions .page").html("");b=h;for(var g=j*72;g<(j+1)*72&&g<emotions[h].length;++g){a("#emotions .containersina").append(a('<a href="javascript:void(0);" title="'+emotions[h][g].name+'" ><img src="'+emotions[h][g].icon+'" alt="'+emotions[h][g].name+'" width="22px" height="22px" /></a>'))}a("#emotions .containersina a").click(function(){d.insertText(a(this).attr("title"));a("#emotions").remove()});for(var g=1;g<emotions[h].length/72+1;++g){a("#emotions .page").append(a('<a href="javascript:void(0);"'+(g==j+1?' class="current"':"")+">"+g+"</a>"))}a("#emotions .page a").click(function(){e(h,a(this).text())});a("#emotions .categorys a.current").removeClass("current");a("#emotions .categorys a").each(function(){if(a(this).text()==h){a(this).addClass("current")}})}}})(jQuery);